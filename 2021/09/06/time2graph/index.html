<!DOCTYPE html>
<html>
    <head>
    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover" name="viewport" />
    <meta name="google-site-verification" content="O8l6Gdlm_7wLcePiA_vmgbeJoEon6vWqVfNFEdF35Vk" />
    <meta name="baidu-site-verification" content="code-Mg16qTh6pa" />
    <link rel="alternate icon" type="image/png" href="/img/favicon.png">
    <title>[PaperRead] Time2graph: Revisiting time series modeling with dynamic shapelets</title>
    <!-- 
        <title>[PaperRead] Time2graph: Revisiting time series modeling with dynamic shapelets</title>
     -->
    
<link rel="stylesheet" href="/css/reset.css">

    
<link rel="stylesheet" href="/css/style.css">

    
<link rel="stylesheet" href="/css/markdown.css">

    
<link rel="stylesheet" href="/css/fonts.css">

    <script async defer data-website-id="e0d038ef-ec21-43e8-8170-a40528b7f0f6" src="https://abingcbc.cn:5100/analysis.js"></script>
<meta name="generator" content="Hexo 5.4.2"></head>
    <body>
        <div class="paper">
            <div class="paper-main">
                
                    <div class="post-header">
    <a class="logo" href="/">Bingchang Chen</a>
    <a class="go-home" href="/">
        <svg width="8" height="14" viewBox="0 0 8 14">
            <path d="M7 1L1 7l6 6" stroke="#000" stroke-width="2" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
    </a>
</div>
                
                <div class="post-main">

    
        <div class="post-main-title">
            [PaperRead] Time2graph: Revisiting time series modeling with dynamic shapelets
        </div>
        <div class="post-meta">
            2021-09-06
            &nbsp;&nbsp;
            <span id="busuanzi_container_page_pv">
                <i class="iconfont icon-eye" aria-hidden="true"></i><span id="busuanzi_value_page_pv"></span>次
            </span>
        </div>
    

    <div class="post-md">
        <p>Shapelet <a href="#shapelet"><sup>1</sup></a> 是一种常见的对时序数据进行建模的方法之一。从 2009 年在 KDD 上发布第一篇论文以来，其经过了各式各样的变形和改进。Time2graph <a href="#time2graph"><sup>2</sup></a> 观察到 shapelet 具有 time-aware 的性质，因此提出了一种基于 shapelet 的时序数据的建模方法，将数据建模成图结构。</p>
<span id="more"></span>

<h2 id="What"><a href="#What" class="headerlink" title="What"></a>What</h2><h3 id="Shapelet"><a href="#Shapelet" class="headerlink" title="Shapelet"></a>Shapelet</h3><p>A shapelet is a segment that is representative of a certain class.<br>Shapelet 是一段具有代表性的子序列，它可以将一条时序数据的所有分段分成两类，一类与其相似，另一类与其不同。</p>
<h3 id="Time-aware-shapelet"><a href="#Time-aware-shapelet" class="headerlink" title="Time-aware shapelet"></a>Time-aware shapelet</h3><p>Time2graph 中所创新性提出的包含时间信息的 shapelet，利用图对其在时间维度上的变化进行捕捉。</p>
<h2 id="Why"><a href="#Why" class="headerlink" title="Why"></a>Why</h2><p>传统的 shaplet 以及其改进形式都忽略了 shapelet 在不同的时间区间上的表现能力。这造成两点不足：</p>
<ol>
<li>相同 shapelet 在不同时间区间上的含义不同。</li>
<li>shapelet 之间的变化关系也表示了时序数据的一些信息。</li>
</ol>
<h2 id="How"><a href="#How" class="headerlink" title="How"></a>How</h2><h3 id="Time-Aware-Shapelet-Extraction"><a href="#Time-Aware-Shapelet-Extraction" class="headerlink" title="Time-Aware Shapelet Extraction"></a>Time-Aware Shapelet Extraction</h3><p>Time-aware shapelet 的抽取可以分为以下三个步骤</p>
<ol>
<li><p>分段</p>
<p> 这里需要超参数如：每个分段的长度</p>
</li>
<li><p>选取 Candidate</p>
<p> 这一部分在论文中没有叙述，但阅读源代码后，我们可以发现，针对所有分段后得到的片段，有两种方法从中得到 candidate shapelet。第一种是通过聚类，例如 K-Means，和 DTW 作为距离进行聚类，然后选取类中心的片段作为 candidate。第二种则是贪婪的方法，即遍历计算一个片段与其他所有片段之间的距离，然后选取平均最小的片段作为 candidate。</p>
</li>
<li><p>计算评分</p>
<p> Time2graph 设计了新的评分方法来衡量 shapelet 在时间维度上的重要度，这部分比较复杂，后文会进行详细的介绍。对所有的 shapelet candidate 打分后，我们就可以选取 top-k 作为真正的 shapelet。</p>
</li>
</ol>
<h4 id="Distance"><a href="#Distance" class="headerlink" title="Distance"></a>Distance</h4><p>Time2graph 设计了两个需要训练的参数，local factor <strong>w</strong> 和 global factor <strong>u</strong> 来分别衡量 shapelet 内部每个元素的重要度以及 shapelet 在不同时间段上的重要度。</p>
<p>训练的过程需要进行梯度下降，损失函数如下图所示<br><img src="/asset/time2graph/loss_function.png"></p>
<pre><code>v: shapelet
T: time series
S∗(v, T): the set of distances with respect to a specific group T∗
g: differentiable function measures the distances between distributions of two finite sets 
</code></pre>
<p>最后两项为 penalties。当梯度下降使得损失函数的值越来越小时，<code>w</code> 和 <code>u</code> 就越来越可以使得 shapelet 到 positive 和 negative 的距离之差越来越大，这样 shapelet 就越能代表一个类。</p>
<p>接下来，详细介绍损失函数中所用到的两个距离函数。</p>
<ol>
<li>shapelet 与 segment 之间的距离</li>
</ol>
<p><img src="/asset/time2graph/dist_seg.png"></p>
<pre><code>w: local factor 需要学习的参数
u: global factor 需要学习的参数
s: segment
a: alignment，利用 DTW 可将长度为 i 的 v 和长度为 j 的 s 对齐成长度为 p 的 a1 和 a2
</code></pre>
<p>对于 DTW alignment，下面这张图形象地解释了整个对齐的过程</p>
<p><img src="/asset/time2graph/dtw.png"></p>
<p>对于序列 s1 和 s2，s1 中的一个点可能对应 s2 中的多个点，同时 s2 中的一个点也可能对应 s1 中的多个点。所以，两者对齐后，会得到一个新的长度的序列。而 shapelet 与 segment 的距离，其实就是计算两者对齐后的欧氏距离。</p>
<ol start="2">
<li>shapelet 与 time series 之间的距离</li>
</ol>
<p><img src="/asset/time2graph/dist_series.png"></p>
<p>这个就比较简单了，<code>d</code> 即为刚刚介绍的 shapelet 与 segment 之间的距离。shapelet 与 time series 的距离即为与 time series 的所有分段中的权重最小值。</p>
<h3 id="Shapelet-Evolution-Graph"><a href="#Shapelet-Evolution-Graph" class="headerlink" title="Shapelet Evolution Graph"></a>Shapelet Evolution Graph</h3><p>接下来，就是要构建图来表示 shapelet 之间的转移关系。</p>
<p><img src="/asset/time2graph/graph.png"></p>
<p>算法先将 shapelet 与 segment 关联起来，edge 的权重由以下这个公式计算</p>
<p><img src="/asset/time2graph/edge_weight.png"></p>
<p>公式计算的是 shapelet 与 segment 相关的概率，如果 shapelet 与 segment 之间的距离越近，那么相关的概率越高。</p>
<p>接下来，算法将相邻的 segment 的 shapelet 连接起来，而 edge 的权重则是前后两个 segment 与各自 shapelet 之间关联概率的乘积，代表了从前一个 shapelet 迁移到后一个 shapelet 的概率。</p>
<p><img src="/asset/time2graph/transition.png"></p>
<p>最后，算法将一个 shapelet 所有迁移出去的 edge 的权重进行归一化，使其和为 1。</p>
<p>算法的伪代码如下所示</p>
<p><img src="/asset/time2graph/graph_algo.png"></p>
<h3 id="Representation-Learning"><a href="#Representation-Learning" class="headerlink" title="Representation Learning"></a>Representation Learning</h3><p>最后，time2graph 采用了 DeepWalk <a href="#deepwalk"><sup>3</sup></a>的算法，将 shapelet 转换为 embedding 的形式。</p>
<p>接下来，就可以利用 shapelet 的 embedding 来表示 segment 和 time series。</p>
<p>segment 的向量化表示如下面这个公式，就是其相关 shapelet 的 embedding 的概率权重和</p>
<p><img src="/asset/time2graph/segment.png"></p>
<p>而 time series 的向量化表示就是将其所有 segment 的 embedding 的拼接。</p>
<p>算法的伪代码如下所示</p>
<p><img src="/asset/time2graph/representation.png"></p>
<h3 id="Apply-Time2graph"><a href="#Apply-Time2graph" class="headerlink" title="Apply Time2graph"></a>Apply Time2graph</h3><p>至此，我们就完整的了解了 time2graph 的训练过程。那么 time2graph 的应用过程也与之类似。</p>
<p>首先，算法的输入仍然是一个 time series。算法会先对其进行分段，然后为每个 segment 分配相关的 shapelet。接下来，就可以得到 segment 和 time series 的 embedding，进行后续聚类或者其他操作。</p>
<h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><div id="shapelet" />
- [1] Ye, Lexiang, and Eamonn Keogh. "Time series shapelets: a new primitive for data mining." Proceedings of the 15th ACM SIGKDD international conference on Knowledge discovery and data mining. 2009.

<div id="time2graph" />
- [2] Cheng, Ziqiang, et al. "Time2graph: Revisiting time series modeling with dynamic shapelets." Proceedings of the AAAI Conference on Artificial Intelligence. Vol. 34. No. 04. 2020.

<div id="deepwalk" />
- [3] Perozzi, Bryan, Rami Al-Rfou, and Steven Skiena. "Deepwalk: Online learning of social representations." Proceedings of the 20th ACM SIGKDD international conference on Knowledge discovery and data mining. 2014.
    </div>

    
        <div id="gitalk" style="width: 100%"></div>
    

</div>

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_ba1fz6golrf.css">
<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_kmeydafke9r.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css">
<script src="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js"></script>
<script>
    if (document.getElementById("gitalk")) {
        if (!window.__gitalk) window.__gitalk = new Gitalk({
            owner: 'abingcbc',
            repo: 'blog-comments',
            clientID: '225e0f79fd64ca42f501',
            clientSecret: 'e89fabf7e34f6646cf659179f7cd7943da170ce4',
            admin: ['abingcbc'],
            id: location.pathname
        });
        Object.assign(__gitalk, {
            id: decodeURIComponent(location.pathname),
            title: document.title,
            link: location.href,
        });
        __gitalk.render('gitalk');
    }
</script>
                <div class="footer">
    <span>Copyright © 2022 Bingchang Chen</span>
    <span>Theme Designed By <a target="_blank" href="https://zheli.design/one-paper">這Li</a></span>
    <span id="busuanzi_container_site_pv">
        Total views:&nbsp;<span id="busuanzi_value_site_pv"></span>&nbsp;times<br>
    </span>
    <span id="busuanzi_container_site_uv">
        Total visitors:&nbsp;<span id="busuanzi_value_site_uv"></span>&nbsp;times
    </span>
</div>


<link rel="stylesheet" href="/css/a11y-dark.min.css">


<script src="/js/highlight.min.js"></script>


<script src="/js/highlightjs-line-numbers.js"></script>

<script defer src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" ></script>
<script>
    hljs.highlightAll();
    hljs.initLineNumbersOnLoad();
</script>

            </div>
        </div>
    </body>
</html>